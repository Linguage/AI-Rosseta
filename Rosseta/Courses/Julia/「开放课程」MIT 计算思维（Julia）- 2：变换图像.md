# 「开放课程」MIT 计算思维（Julia）- 2：变换图像

- 视频链接：[Transforming Images , MIT Computational Thinking Spring 2021 | Lecture 2](https://www.youtube.com/watch?v=uZYVjDDZW9A&list=PLP8iPy9hna6T56GkMHEdSrjCCheNuEwI0&index=2)
- 官方频道：[链接](https://www.youtube.com/@TheJuliaLanguage)


### 讲座介绍

本篇文档记录了 MIT 计算思维入门课程 2021 年春季第二讲“变换图像”的演讲实录。讲座以 Julia 编程语言为工具，系统性地探讨了数字图像处理中的若干核心概念与技术。

讲座首先从课程管理信息和对 Julia `Unitful.jl` 包的有趣演示入手，展示了在编程中处理物理单位的便捷性，并借此引出 Julia 类型系统的优势。随后，内容逐步深入图像变换的基础操作，包括通过降采样和升采样实现像素化效果，以及利用线性组合与凸组合的概念来混合与叠加图像，并提及了相关的视觉感知现象。

讲座的核心聚焦于图像滤波技术，特别是卷积运算。通过引用 Grant Sanderson 的精彩讲解片段和 Photoshop 实例，生动解释了卷积的原理及其在实现模糊、锐化、边缘检测等效果中的应用。讲座详细介绍了多种常用卷积核（如恒等核、模糊核、梯度核、高斯核）的定义、数学形式及其在 Julia 中的实现与效果展示，并穿插了师生关于“锐化”定义的问答讨论。

此外，讲座还结合图像处理的实践，探讨了相关的计算机科学议题，如卷积运算的计算复杂度、GPU 在加速此类运算中的作用，以及 Julia 中 Offset Array 数据结构在处理卷积核时的便利性。最后，讲座引导听众思考离散与连续概念在计算中的关联，并指出了图像处理中必须面对的边界处理问题。

### 内容纲要

```
MIT 计算思维 2021春季 | 讲座 2：变换图像
├── 一、 引言与设置
│   ├── 课程简介与安排 (时长调整, 微世纪概念)
│   └── Julia Unitful.jl 包演示 (单位运算, 类型系统优势)
├── 二、 基本图像变换
│   ├── 像素化 (降采样/升采样)
│   │   ├── 降采样 (隔点选取)
│   │   └── 升采样 (克罗内克积)
│   └── 线性组合 (图像合并)
│       ├── 概念与普遍性
│       ├── 图像缩放 (标量乘法, 广播)
│       ├── 图像叠加 (加权求和)
│       └── 凸组合
│           ├── 定义 (非负权重和为1)
│           ├── 图像混合示例 (正向与倒置图像)
│           └── 关联现象 (面孔倒置/撒切尔效应)
├── 三、 核心概念：图像滤波与卷积
│   ├── Photoshop 中的效果演示 (模糊, 锐化, 边缘检测, 扭曲)
│   ├── 引入卷积 (Convolution)
│   │   ├── 作为多种效果的基础 (模糊, 锐化, 边缘检测)
│   │   ├── 与机器学习的联系
│   │   └── 引用 Grant Sanderson 的可视化解释
│   └── 卷积与核 (Kernel) 的定义
├── 四、 常见滤波器/核及其应用
│   ├── 在 Julia 中定义和演示核
│   │   ├── 恒等核 (Identity)
│   │   ├── 边缘检测核 (Edge Detect)
│   │   ├── 锐化核 (Sharpen) - 讨论不同定义
│   │   ├── 方框模糊核 (Box Blur)
│   │   └── 梯度核 (X/Y Gradient) - 与导数类比
│   └── 高斯滤波器/模糊 (Gaussian Filter/Blur)
│       ├── 概念 (权重由高斯函数决定)
│       ├── Grant Sanderson 视频解释 (加权平均)
│       ├── 高斯核的数学形式 (`$e^{-(x^2+y^2)/(2\sigma^2)}$`)
│       └── Julia 实现与可视化
├── 五、 相关的计算机科学概念
│   ├── 复杂度 (Complexity) - 卷积运算与核大小关系
│   ├── 计算架构 (Architectures) - GPU 对规则运算的加速作用
│   └── 数据结构 (Data Structures) - Offset Arrays (偏移数组) 的应用
├── 六、 拓展思考与实践问题
│   ├── 离散 vs. 连续 (Discrete vs. Continuous) - 两者联系的探讨
│   └── 边界处理 (Boundary Handling) - 卷积操作中的实际问题与策略
└── 七、 总结
    └── 讲座结束 (遵守微世纪时长)
```


---

# MIT 计算思维 2021春季 | 讲座 2：变换图像 - 演讲实录

## 一、 引言与设置

大家好，互联网上的朋友们，还有麻省理工学院的同学们。

给麻省理工学院同学的快速提醒：如果你们发言或分享视频，你们可能会出现在直播中。我们认为这不会发生，但无法保证。所以，如果你不介意你的声音被公开，欢迎提问。否则，麻省理工学院的同学可以使用聊天功能，Discord 或 Zoom 聊天。我们也邀请公众使用 Discord 和 YouTube 聊天。

好的，再次欢迎大家。这是 MIT 计算思维入门课程的第二讲。如果你访问课程主页，我们现在讲到了目前标记为 1.3 节的内容。我们还在调整这些标签，但今天的课程将关于变换图像。

提醒一下麻省理工学院的同学们，第一次作业将于周五截止。就是这里的作业 1。我可以点击这个，你们可以自己下载。我已经加载了一个活动的 notebook，所以我将使用那个 notebook。

关于课程通知，我们决定将讲座时间调整为更接近一小时，而不是一个半小时。在虚拟教学期间，这似乎是正确的做法。关于这一点，我不知道你们是否知道这本精彩的书，作者是 Gian-Carlo Rota，他是数学系的教授，几年前去世了。他是一位非常伟大的人，给出了关于做讲座的 10 条建议。我认为建议之三是：永远，永远不要让讲座超时。他重复了约翰·冯·诺伊曼（一位著名的数学家和计算机科学家）的建议，那就是讲座时长不应超过一个“微世纪”（microcentury）。

所以关键就在这里，让我们把它放大一些。讲座的关键时间单位是“微世纪”，一刻也不能长。你可能会好奇一个微世纪是多长，这是一个展示 Julia 单位包 (`Unitful.jl`) 的好机会。

看一下这里加载的包，顶部加载的是 `Unitful.jl` 包。如果你想表示 100 年，也就是一个世纪 (century)，你只需要输入，这个 `u"yr"` 的东西是一种特殊的字符串。它是一个单位字符串，指代年的单位。所以一个世纪就是一百个这样的东西，也就是 100 年。然后你可以对它进行数学运算。`世纪 * 2` 是 200 年，`世纪 / 200` 是半年，`世纪^2` 你会看到单位变成了平方年。所以 Julia 允许你对单位进行各种数学运算。这是一个米单位除以秒平方单位的例子。这就是重力加速度的单位 $m/s^2$。

所以如果你真的想知道一个微世纪是多长，你只需要做一个单位转换，将百万分之一世纪 ($10^{-6}$ 世纪) 转换为分钟单位。它会告诉你，大约是 53 分钟。所以根据约翰·冯·诺伊曼的说法，一个微世纪是讲座的完美长度。

再讲几点关于单位的，因为玩起来很有趣。假设你想计算势能，使用你可能在物理课上见过的标准旧公式 $m \times g \times h$，即质量乘以重力加速度乘以移动的距离。这里有个例子，10 千克乘以 $g$ 乘以 50 米，结果是 4900 千克米平方每秒平方 ($kg \cdot m^2 / s^2$)。你可以把它转换成焦耳 (joules)，你可能已经知道那就是 1 焦耳 (Joule)。

更宏大的图景不是你能处理单位。单位只是有点有趣。真正宏大的图景是关于 Julia 内部机制的一点洞察，我们以后会更多地看到这一点。但就 Julia 的内部机制而言，发生的事情与类型系统有关。你可能还不知道那意味着什么，但存在某种底层技术，意味着你不必为了让代码处理单位而重写它，某种程度上，Julia 中定义的普通算术运算，当我们把单位推入其中时，它就能正常工作。这就是我们通常寻求的系统：你可以想出新的用途，而一切都能正常工作。

顺便说一句，如果这一点能帮助你在其他课程中做习题集，我说，尽管用吧。没有人应该再手动追踪单位了，这非常繁琐。这确实是计算机该做的工作，尽管我确信许多基础课程仍在教授这个。

好吧，但今天的讲座不是关于单位的，不过它会是一个微世纪的时长。今天的讲座是关于变换图像。

我要提醒你们，我有我最喜欢的柯基照片，哦，我的助手刚走进房间。这是 Phillip，就在我身后。我将使用柯基的照片，但你可以用你自己的照片，任何你喜欢的。

## 二、 基本图像变换

那么，让我们来看一系列图像变换，真正的目标，我是说玩图像很有趣，我喜欢玩图像，停不下来，但真正的目标是阐释数学思想和计算机科学思想。所以我们会在这个过程中看到卷积、线性、线性组合。今天我们还会看到一点点复杂性。所以这些成了我们看到那些在数学和计算机科学中随处可见的思想的契机。但让我们从头开始。

### 像素化 (降采样/升采样)

今天早些时候，我在谷歌上搜索了一张像素化的柯基，所以这里有一个被像素化的小家伙。但实际上，关于这张图片有趣的是，这张图片是——[狗叫声] 是的，这里有只真正的柯基，如果它不安静，它可能会被像素化。它在那儿。所以这张图片实际上不是，它只是看起来像素化了。它实际上是我从网上获取的一张非常高分辨率的图片。所以我不打算用这张像素化的柯基，但我会用 Phillip。这是我常用的 Phillip 的标准照片。

我要做的是对 Phillip 进行降采样。我们在之前的讲座中已经见过这个了。我要做的是取每第 $r$ 个像素，其中 $r$ 是一个可以变化的数字。所以如果 $r$ 变大，图像会变得更像素化，因为我取的像素更少。系统会重新绘制，但当 $r$ 趋于 1 时，我得到原始图像。这就是降采样。

然后我会进行升采样，我会通过一种叫做克罗内克积 (Kronecker product) 的数学运算来完成。这里，让我把这个调小一点，这样你可以看到。我们会看到它发生，然后我们可以解释发生了什么。这里是高度像素化的，这里是原始图像，以及介于两者之间的所有状态。

这里的操作是克罗内克积。这个操作基本上是说，取每个像素，在你看到 1 个像素的地方，用一个由 1 组成的 $r \times r$ 矩阵替换它，就像这里一样。让我们把 $r$ 调小，比如 3，这样你可以看到。当 $r=3$ 时，我们做的是对降采样后的 Phillip（就是右边这张图）和一个 $3 \times 3$ 的全 1 矩阵做克罗内克积。所以，它所做的，完全就是取这里的这个像素，然后替换它。我可以用笔像这样画一下，但它会取像这个像素，然后用一个具有完全相同颜色的 $3 \times 3$ 像素阵列替换它。然后它会对这个像素做同样的事情，用一个相同颜色的 $3 \times 3$ 阵列替换它。这就是克罗内克积所做的。如果你想了解更多关于克罗内克积的信息，我放了维基百科的文章链接，你可以看到这具体是怎么运作的。但现在，我认为看到这是一种快速升采样的方式就足够了。

### 线性组合 (图像合并)

现在，让我继续讨论另一个，更宏大的数学思想，我相信每个人都以某种方式，或者多次见过——线性组合的思想。

对于线性组合，我将合并图像。我不知道你在哪里见过线性组合。也许你见过函数的线性组合，或者在另一门课上见过信号的线性组合，或者如果你上过线性代数课，你可能见过向量的线性组合。或者如果你上过微分方程课，你可能见过微分方程解的线性组合。所以线性组合，你可能已经明白了，它遍布数学、应用数学、工程学，无处不在。

无论你以前是否见过，我都会提醒你，线性组合的核心思想是它实际上是两种基本运算的组合：你可以缩放一个对象，然后你可以组合两个或多个对象。所以你把这两者结合起来，我们就谈论组合多个对象的缩放版本。

让我们看看这在图像处理中是什么样子。这里有一些柯基，这不是 Phillip，这只是我在网上找到的一些柯基饼干。好了，这里有一些柯基，我要做的是把这些柯基乘以 $c$。

只是为了让你明白。这是柯基。 [狗叫声] 我背景里有只吵闹的柯基。我想是邮递员来了什么的。这是 `柯基 * 2`，你会看到这当然会使像素变亮，对吧。它更趋向于白色。如果我用 `柯基 * 10`，它几乎会完全变白。另一方面，如果我用 `柯基 * 0.1` (原文是 1.1，但效果应为变暗，故调整为 0.1)，它就变得有点灰暗。这是 `柯基 * 0.5` (原文是 5.5，效果应为变暗，故调整为 0.5)，它变得越来越暗。

所以我想做的正是这个，我会用一个滑块来做，因为用滑块更有趣。我有一个滑块，可以设置在 0 和 3 之间。我可以玩一下，给柯基增加更多亮度。一旦颜色达到白色，它们就会饱和。所以不像向量和函数，亮度有一个上限，一种上界。但尽管如此，这是一个柯基图片的标量倍数。

我再次鼓励你放入你自己的图片。你只需要在这里放入你自己的 URL，然后就可以了，或者直接从你的文件系统加载一张图片。所以你也可以这样做。事实上，这引出了一个观点，很多很多年来，我们为各种课程准备了固定的计算机演示，有人写好了程序，图片加载好了，就这样。它不能被改变，里面可能有 $c$ 的各种选择，但它们不能被改变。我们不再喜欢那样了。我们真的相信软件的美妙之处在于，它不是关于教授在 Zoom 上告诉你用哪些数字。我们希望你拥有完全的控制权并玩转这些东西。我喜欢柯基，你可能喜欢猫，都没关系。

关于点乘 (`.*`) 快速说一句。这是一个逐点乘法。实际上即使没有点也能工作。你看我可以这样做，它仍然有效。但良好的行为规范是进行逐元素乘法，它的真正含义是柯基图片中的每个像素都乘以这个常数 $c$。这就是所谓的广播 (broadcast)。我喜欢称之为逐点 (pointwise)，但你看这是一个标量，这是一个图像。我们希望那个标量作用于图像中的每一个像素。好的，这就是点号的作用，它作用于每一个元素。

好的，这就是标量乘法，你可能在各种关于线性的讨论中见过。现在，还有另一个。记得有标量乘法和组合两个对象。让我们抓取另一个对象。我可以加载另一张图片，但我决定把柯基倒过来。这里是一些倒置的柯基。我向你保证，如果我对 Phillip 这样做，他不会喜欢的。他会抱怨。但我反转了行索引，所以现在这些柯基是倒置的。

我在这里要做的是组合这两个图像。这里我将取我的倒置图片的一半 ($0.5 * \text{倒置柯基}$) 加上我的正向图片的一半 ($+ 0.5 * \text{正向柯基}$)，你可以看到，叠加起来，就是这么简单。这就是线性组合的真正含义。如果你仔细看，也许我可以放大一点，但如果你非常仔细地看，你可以看到有一个倒置的柯基和一个正向的柯基。

顺便问一下，这是只有我这样吗，但我注意到，这有点像心理学上的现象，我的大脑，你知道无论人脑中进行何种处理，似乎更偏爱——即使这些图片显然是等权重的，对吧。一半对一半 ($0.5$ 和 $0.5$)，但不知何故，当我看着这张图片时，我看到的正向柯基比倒置的更清晰。就像是权重是 50-50，但我的大脑…我不知道——你们也看到这个现象了吗？我很好奇，但我的大脑更清晰地看到预期的，你知道，正向的柯基。

### 凸组合 (Convex Combinations)

事实上，我们可以通过采用其他组合来实际研究这种现象。所以我想做的是取 $\alpha$ 乘以正向柯基 ($\alpha * \text{正向柯基}$)，加上 $(1-\alpha)$ 乘以倒置柯基 ($+ (1-\alpha) * \text{倒置柯基}$)。所以，当 $\alpha=1$ 时，柯基看起来是它们应该的样子。当 $\alpha=0$ 时，柯基看起来像是要从地上掉下来，它们是倒置的。在 $\alpha=0.5$ 时，它们正好在中间。

这是你迟早会遇到的另一个数学概念。让我看看，哦，好的，一位同学在聊天中说这是一种常见的知觉错觉。酷，很高兴你知道。你知道那种知觉错觉的名字吗？如果你知道名字，可以输入到聊天中。

所以我以前不知道这种常见的错觉，有位同学知道。但我以前不知道这个，但我查了一下。

首先，数学要点，然后是心理学要点。数学要点是，如果你取的线性组合系数都是正的或非负的，并且加起来等于 1，这被称为凸组合 (convex combination)。
[狗叫声] 哦，现在是快递来了，抱歉。也许我该关上门。请稍等片刻。[狗叫声] 我的合作教授对凸组合非常非常兴奋。

好了，总之只是为了好玩，这是我差不多才发现的事情。我们将取一个凸组合，同样是 50-50 的权重，我决定看看我的大脑大致在哪个点上愿意说它们是同样程度的倒置。比如如果我调到 0，它显然是倒置的。我的大脑毫无疑问，不会有其他看法。如果我调到这里（接近 1），它显然是正向的。但同样，50/50 在我的大脑里不是 50/50。所以我打算增加更多倒置的成分。我最终为自己决定，你可以自己试试看，大约在 $\alpha=0.39$ 时，当我盯着图像看，我会说——记住这是 61% 的倒置和 39% 的正向——但在我的大脑里，我感觉这是 50-50。同样，你可能会发现不同的结果。

我查了一下这个，发现在互联网上有一种适用于人类的现象。它被称为“面孔倒置效应”（Face Inversion Effect），我刚学到这个，我只是像任何人一样在读维基百科。我对这些东西都不是专家。但显然，倒置的面孔不像正向的面孔那样容易识别。相比之下，物体没有这个问题。由此推断，物体识别发生在大脑的不同区域，与面部识别不同。

好的，有人提到了“撒切尔效应”（Thatcher illusion）。一位同学提到了撒切尔效应。我甚至不知道这个词，酷。我们更难检测——好的，所以是撒切尔。是因为例子用了玛格丽特·撒切尔吗？我明白了。我不知道那个，撒切尔效应。谢谢你。非常感谢。

所以我断定，这不仅适用于人脸，也适用于柯基。这是我昨晚刚学到的。好了，这是我 5 分钟的纸上谈兵科学，你知道，心理测量学之类的。但听起来其他人也知道这个现象。所以如果你以前从未见过，你可以自己玩玩。

好的，凸组合——看，我们学到了多少有趣的数学。我们有凸组合，线性组合。

## 三、 核心概念：图像滤波与卷积

### Photoshop 中的乐趣

我想看看现实世界中人们会做什么样的图像变换。比如人们都做什么？所以我决定，我不是一个 Photoshop 用户，每次我尝试使用 Photoshop，也许你们中有些人是专家。如果有麻省理工学院的学生真的精通 Photoshop，也许你可以在聊天中告诉我。我很想知道你是谁。但每次我尝试使用 Photoshop，我发现界面总是不符合我的预期，它会做些别的事情。但无论如何，我昨天决定打开它。

这是 Photoshop，让我——是的，回到这里。这是那张著名的照片。我刚把它加载到 Photoshop 中。我只是想看看我能对这张照片做些什么。这里有这个——哦，大家能看到我的屏幕吗？可能不行。让我——我想我只分享了，抱歉，我想我需要分享我的整个桌面才能让你们看到我想让你们看的东西。

好了，这是 Photoshop。Phillip 就在 Photoshop 里。我不知道，我想我甚至需要抓取整个图片，也许我不需要那样做，但那样可以。我非常感兴趣的是“滤镜”(Filter) 菜单下拉出来的东西。我有点想知道选项菜单。我内心有一部分想专注于模糊 (blur)。

好吧，让我们从像素化 (pixelate) 开始，因为我们已经用 Julia 做过一次像素化了。所以如果我们，让我们看看，像素化，我们来做一个像素化。哪个是好的？是马赛克 (mosaic) 吗？有了。是的，所以这个，这个我们已经用 Julia 做过了，对吧。这挺有趣的。我们可以取消这个。

但让我们看看，有模糊。让我们模糊一下，有各种各样的模糊。哦，它没做，它做了什么吗？我是不是必须，就像我说的，我警告过你们，我不擅长这些东西。好吧，让我们看看模糊。让我们做一个高斯模糊 (Gaussian blur)。好的，高斯模糊带有一个半径。如果半径很小，它几乎不模糊。当我把这个半径向右移动，它开始变得模糊。看得我眼睛都有点痛了，直到你甚至找不到 Phillip 了。所以这就是高斯模糊，对吧。

我想这大概是你如果只想，你知道，隐藏某人身份时会做的事情，对吧。比如我可能会——哎呀，我刚擦掉了，这是一种方法，擦掉它。我想抓住他的一小部分，然后我就可以通过高斯模糊把东西模糊掉，对吧。这样就只模糊了图像的一部分。

还有几个我想给你们展示一下，同样我不知道你们中是否有人玩过这类东西。我是说 Photoshop 对每个 MIT 的人都是可用的。所以我就想试试。让我看看，那个我们做的，有锐化 (sharpen)，哦，这个。我稍后想给你看扭曲 (distort)。但是哦，是的，风格化 (stylize)，查找边缘 (find edges)。边缘检测总是一个大问题。所以我想，我是说那看起来其实不错。它找到了 Phillip 皮毛上所有细小的毛发。

好的，这是边缘检测。然后让我，作为对比，给你看一些非常奇怪的，比如扭曲。其中一个几乎离奇到无法用言语形容的是极坐标 (polar coordinates)。它实际上，我是说它把 Phillip 扔进了洗衣机，这是我能形容的唯一方式。这是一个非常非线性的变换。所以如果你上过一些课程，学过线性变换，并且你曾想过，他们没告诉你的是什么，非线性变换是什么样的，这里有一个例子：Phillip 通过洗衣机绝对是一个非线性变换。

好了，这就是我们在 Photoshop 中能做的。让我回到我们能做的。事实证明，其中许多都可以很容易地用直接的软件来完成，在那里你有所有的控制权。我是说，显然没有什么是像在菜单上指指点点那么容易的。但很多这些事情是可以做到的。

我想专注于——让我先专注于模糊、锐化和查找边缘，因为这些都是卷积的例子。所以这些是，我们马上会发现卷积是什么，但我现在要说的是，卷积如今在机器学习中出现。所以每个人都知道计算机擅长从橘子图片中挑出苹果图片。它们是怎么做到的？嗯，它们是通过卷积做到的。我稍后会再说几句。卷积也是一个数学概念。你可以对函数进行卷积。

### 图像滤波 (卷积) 介绍

但今天我们来谈谈，我们将讨论将图像与一个核 (kernel) 进行卷积。这是我们将使用的语言。上学期我们讨论这个的时候，这节课是由 Grant Sanderson 讲的，他简直太棒了，绝对精彩。一位绝对精彩的讲师，所以我想我应该从 Grant 上学期的讲座中挑选一些片段。当然，你们也完全可以自己去听。但这里让我——这个出来对了吗？是的。

我想——我把这个设置为从 64 秒开始，到 168 秒结束。所以让我们看看这是否真的按我想要的方式工作。我可能需要再次执行它才能让它那样工作。我想从 64 秒开始，我要播放 100 秒，因为这太精彩了。我想你们都会喜欢的。让我来做。当然。

*（模拟 Grant Sanderson 视频片段内容，进行转述而非直接引用）*

卷积非常有趣，能让你做很多强大的事情。所以我们直接开始吧。第一个例子，我将用这个我们看到的 8 位马里奥，这个非常低分辨率的图像。我想模糊它。如果你想模糊图像，你可能首先想到的是查看每个像素，并将其与其所有邻居进行平均，进行一种移动平均。

我这里的方式是，我们有一个小的网格，一个 $3 \times 3$ 的数值网格。它在图像上移动，并在右侧缓慢地创建一个新图像。具体来说，这里发生的是，网格中的每个值都是 $1/9$，我们想象着将它们与一些像素对齐，将每个值乘以对应的像素值，然后将它们加在一起。所以在这种情况下，如果它们都是 $1/9$，我们把它们相乘再相加，我们实际上只是取了 9 个像素的平均值。

在这个特定的窗口中，看起来有 4 个黑色像素，4 个灰色像素，还有 1 个是马里奥肤色那样的颜色。所以你会期望平均值是像一个带有极微弱马里奥肤色色调的深灰色。如果我们去看看正在生成的新图像以及绘制到那个像素上的内容。那是什么？它是一个带有极微弱某种肤色色调的深灰色。

随着我们继续移动，我们得到了这个更模糊的马里奥图像。我们可能放大另一个例子。这里，这个网格主要覆盖了肤色，只有一点点黑色在这里那里。所以我们期望它是一个降低了亮度的版本，这就是我们看到的。当我们缩小并看到曾经清晰的 8 位马里奥时，这给出了一个很好的效果，分辨率相同，分辨率没有任何改变，但我们得到的是这种模糊的——

*（结束模拟视频片段转述）*

好的，那么我怎么？哎呀，我怎么去掉这个？嗯，不行，那不管用。也许按 Esc 键。Esc，谢谢。我早该知道的。谢谢你，Dave。

好的，我还会放一些这个视频的其他片段。整个视频有 36 分钟长。我其实鼓励你们无论如何都去看看，因为 Grant 是一个非常非常棒的演讲者。

### 卷积和核的定义

但让我们进入——让我们进入这个，你大概明白了卷积是什么意思。你可以去这个维基百科页面，如果你愿意的话，看看那个。但是，这里有一些不同的核。但你看发生了什么，你做的是你把这个（核）粘贴到你的像素集上。这一个，恒等核，意味着只取中心的值。所以它实际上什么也没做。但这一个，这里的边缘检测核，说的是取中心值的 4 倍，然后减去它的上、下、左、右邻居。模糊核是取我的上、东北、东、东南、南、西南、西、西北邻居的平均值。所以我想，可能，你明白了。

## 四、 常见滤波器/核及其应用

### 把玩几种核

好的，所以我放了一些核，这是——是的，让我们把这个拿回来。所以我把其中一些核直接放到了 Julia 里，这样我们就可以玩它们了。

这是恒等核 (identity kernel)。让我提醒你们，矩阵表示法在 Julia 中是有效的。我将执行这个。如果我输入 `identity`，哦，我们来看看 `identity`，你可以看到它正是来自维基百科的那个 $3 \times 3$ 模式，对吧。所以我其实不需要。事实上，它会显示在这里。所以我其实不需要这个。让我们清理一下。

所以如果我用恒等核，你会看到是这个模式。如果我用边缘检测 (edge detect) 模式，它正是这个模式——我能同时看到它们吗？我不知道这是不是个好方法。这里，边缘检测模式是这一个。锐化 (sharpen) 模式是，这是一个叠加或者说线性组合。我将取恒等核，然后加上边缘检测核 ($Identity + EdgeDetect$)。所以锐化的意思是找到边缘，但同时保留我原始的图像。然后你可以看到这就是锐化模式。让我们把它放上去。

好了，方框模糊 (box blur) 只是取平均值，对吧，所以它处处都是 $1/9$。你可以看到这里处处都是 $1/9$。这就是方框模糊。

让我们快速看一下 x 梯度 (x gradient)，看看你是否能从微积分中认出它。x 梯度，它实际上是一维的，虽然看起来是二维的。x 梯度说的是取右边值的一半，减去左边值的一半。对吧，如果这是一个函数，让我再拿起我的笔，如果这是一个函数，我只是想说明一下。如果这是我的函数，我实际上有值，比如这是 $f(x)$，如果这是右边的值 $f(x+1)$，那么这是 $f(x-1)$。那么我希望你能看到，如果我应用这个核，我将得到 $f(x+1) - f(x-1)$（除以2，形成中心差分）。我应该用笔写这个，但我用鼠标写。这看起来就像你看《Jeopardy!》决赛时的样子。好了，答案是，好的，所以你看到这是一个中心差分，对吧。你可能从微积分中认出这是一个斜率，对吧，像 $\Delta y / \Delta x$。这是一个离散斜率。它想要成为像导数一样的东西。好的，稍后也会有更多关于这个的内容。

好了，这是 x 方向的梯度。y 方向的梯度 (y gradient) 只是你把它转置一下，这个撇号是转置运算符，它在旁边转置。所以我们得到的是上面是 `-1/2`，下面是 `1/2`。我可能本可以取反的，但实际上也许我们应该取反。这样，哦不，是的，你需要更高的 y。是的，也许取反更好。通常我们会取绝对值，所以没关系。但我这里要取反它，我要做 $\Delta y$，现在是，是的，这可能是更好的方式。

好的，这些是核，现在让我们把这些核应用到各种图像上。好的，所以你也可以这样做。这是柯基。这是柯基，我要么使用这两半中的一个，要么我会显示颜色。所以我要做的是，我要用 `imfilter`，它将实际运行这个。

在作业中，你们将要自己编写卷积，这其实非常容易写。所以你们会真正理解它。但我现在只是用 `imfilter` 命令来向你们展示我在最开始加载的包。`imfilter` 来自 `ImageFiltering` 包。

让我们回到玩这些东西。我只是想向你们展示，就像在五分钟内，我几乎可以写出 Photoshop 的一些基本元素。它并不像某些人可能想的那么神秘，对吧。

所以这是恒等滤波器，它当然给我返回了我的柯基。
边缘检测滤波器，就是它了。你可以尝试不同的值。我把它乘以了 1.5，并且我是在灰度模式下做的。我得告诉你，这些柯基看起来比那些柯基凶猛多了。我不知道你们怎么看，但这是，这是同一张照片。我不知道我是否应该试着把它们放回一起。但这些柯基在我看来很凶猛。我是说它们牙齿的某些地方，你知道。我不知道，但无论如何，这是我把它缩放了 1.5 倍，因为我认为它有点——我可以缩放 0.5 倍，我觉得太暗了。如果缩放 3 倍，就太粗糙了。所以我不知道，我选了 1.5。你也可以用边缘检测器玩这个。

好的，然后是锐化，我想，如果你仔细看，你可以看到它——我是说锐化应该是，让我提醒你，它是恒等和边缘检测的组合 ($Identity + EdgeDetect$)。所以它应该保留原始图像，但同时锐化边缘。我想我差不多能看到效果。我是说，这是原始的恒等。这是锐化。它绝对是，如果你想看，我再做一次，恒等和锐化。所以你可以看到它确实是这样做的。我确信你可以看到这只是几行 Julia 代码。

所以这里还有 x 梯度。它所做的是寻找水平方向上的急剧变化。如果它看到水平方向上的急剧变化，就会用白色来强调。然后这是 y 方向的梯度，在我看来很糟糕，但它寻找 y 方向上的急剧变化。好的，所以 x 方向的效果更好一些。

很多图像处理会做的是取 x 梯度和 y 梯度的组合。我们也会在接下来的讲座中看到这个。对吧，所以这是一个非常常见的做法，就是取某种组合，你可能可以想象，你会想要某种对旋转图片不变的东西。这就是现在人们做的。所以这个 x 梯度很大程度上依赖于 x 方向。而这个很大程度上依赖于 y 方向。

**问：** Alan。是的。抱歉。Zoom 聊天里有个问题。
**答：** 我错过了。谢谢你。它说，好的，“我以为锐化是原始图像减去模糊图像。” 锐化是原始减去模糊吗？所以锐化...所以我们还没有...我是说，我们...你可能可以那样想，对吧？

*（学生补充/澄清观点，可能涉及 $2 \times \text{identity} - \text{blur}$ 的定义）*

我想知道这是否只是谁在做的问题。但是边缘检测，我是说我只是根据这个维基百科页面做了 `边缘检测 + 恒等` ($EdgeDetect + Identity$)。但我不会感到惊讶。是的，所以他们说的是 $2 \times \text{identity} - \text{blur}$。是的，你肯定可以想——不，我不认为你可以——可以吗——是的。
我不会惊讶如果人们也用这个矩阵的负数来做边缘检测。那样的话我会反转符号。所以你是对的，我是说在某种程度上，这是一个更大的现象，在互联网时代之前，在维基百科时代之前从未发生过。但是如果你不遵循维基百科的惯例，比如人们总是有正号和负号，我是说这足以让你发疯。但在过去，没有人会检查你。所以在课堂内部，你可以定义它，那也没关系。但确实总是有不同的惯例。但我不认为 $2 \times \text{identity} - \text{blur}$ 会给我这个答案。

但真正的事实是，对我来说你叫它什么边缘检测器并不重要，我是说——所以这里为了保持你的匿名，除非你想让你的名字公开，我将称你为 MIT 学生。我会采纳 MIT 学生的建议，取两倍的恒等核 ($2 \times \text{identity}$)，然后减去方框模糊核 ($- \text{box blur}$)。好的。

所以现在我必须先添加名字 `MIT_student` 来让这个继续。我想这就是我需要做的所有事情，然后我们就可以看看它是什么了。哎呀，我真的把事情搞砸了吗？`2 .* identity .- box_blur`。哦。哦，哦，哦，它不知道，现在哦，现在怎么了。`2 .* identity`。Dave，你快速看到问题了吗？让我看看，MI——哦，我需要在这里。这里，这里，这里。MIT，我漏掉了那个，现在它满意了。

好了，所以现在我刚刚，看，我刚刚用一个新的滤波器升级了我自己的 Photoshop。好的，这是一个不同的东西。但无论如何，你可以玩它。这就是重点。我真的不在乎你叫它什么。定义你自己的滤波器并摆弄它们，看看它们做了什么，是如此容易。

### 高斯滤波器 (Gaussian Filter)

好的，然后是高斯滤波器。同样地，我要，高斯滤波器有点，它有点复杂，但不是很多。我要让 Grant 来做，我有来自 Grant 的 3 个视频。这是第二个。

*（模拟 Grant Sanderson 视频片段内容，进行转述）*

将那个 $5 \times 5$ 方框中的所有像素同等对待有点奇怪，因为靠近中心的像素在某种程度上比周围较远的像素更能代表图像那个点的情况。

所以对于这个例子，我实际做的是，如果我们放大这里，是给定一个值不全相同的网格，你知道，在这种情况下不全是 $1/25$。但中间那个是 0.162，现在其他区域我们有 0.003。所以当我们把这些值乘以相应的像素值，然后把它们全部加起来，我们基本上是在进行加权求和，权重是根据它离中心的距离来定的。这是一种说法，好的，这个像素受到外角像素的影响是可以的，但只能有一点点影响。我们不应该过多地涉及它。

这些特定的值来自高斯曲线，也称为钟形曲线。所以你可以想象一个钟形曲面坐落在图像之上。它在我们想要的点上方凸起，然后当你离开那个点时，它的值会逐渐减小。这给了我们一个更好的像素平均概念。所以它，就像我说的，它考虑了它们离我们想要的点有多近。

高斯函数具体有一些非常好的数学性质，我们可能在本讲座稍后会讨论。它使得进行这种操作非常非常方便。现在，我们正在做的这个操作，正如你可以从视频标题和关于这个的一切，以及我们上次讨论的内容推断出来的，它是一个卷积。你会说右边的图像，我们得到的最终值，是原始图像与我们这里的小值网格的卷积。

所以这是一个操作，至少在图像处理的背景下，它接收两个不同的值网格，也许一个是 RGB，也许一个是数字，它们都可以是数字。它将它们组合起来得到一个新的值网格。在其他数学背景下，我们通常认为它是组合两个函数得到一个新函数。我们是用这个更小的窗口来做的。通常称它为核 (kernel)。所以在这种情况下，我们会说我们用高斯核对马里奥进行了卷积。

在这一点上，你可能会坐下来想，好吧，你知道，那都挺好的。我想用不同种类的平均，我可以得到图像上不同种类的模糊效果。我想模糊图像有一些用例，比如模糊掉人脸。但它的用途远不止于此。

*（结束模拟视频片段转述）*

Escape。好的，让我们看看我们在哪里？所以你刚刚了解了高斯核。我们看到，假设我想——好的，我想把焦点放在 5 分 23 秒——或者不——这里，我只是想——看看我是否能抓住正确的东西。就像也许我有这个 $5 \times 5$ 的方框在移动。哦，拜托。就在这里。它有点大。但是我们怎么让它稍微向左一点？有了。

好的，这就是你看到 Grant 用来进行平均的 $5 \times 5$ 核。只是为了向你展示，如果你使用 Julia 的 `Kernel.gaussian` 函数并四舍五入到三位小数，你可以检查并看到我这里有相同的数字。我喜欢匹配数字。我觉得我真的理解了事情。

但以防你认为这个高斯的东西非常神秘，让我告诉你，它其实相当简单。它就在这里，我用我的手写体写出来。但它基本上就是 $e^{-(x^2+y^2)/2}$，就是这样。所以在这里你可以看到我，我正在做这个推导（列表推导式），我会得到这个，我会取 $x$ 和 $y$，或者我称之为 $i$ 和 $j$，从 -2 到 2。这样我就得到了一个 $5 \times 5$ 的数组。我只是简单地计算，你知道，$-(i^2+j^2)/2$，然后如果你愿意，可以四舍五入到三位小数，这样看起来就一样了。所以这个高斯核真的没什么神秘的。就是这个非常简单的公式。

好的，这叫做高斯模糊。我们可以做的是，我们可以实际看看这个核，就像 Grant 做的那样，就在这里。所以当——这里的值越小，让我们看看，值越小，核就越小。所以当我在 0 时，我得到一个 $1 \times 1$ 的核，相当无聊。在 1 时，我得到一个 $5 \times 5$ 的核。我们可以让核越来越大。然后用 Julia 你可以放大和缩小，我想现在很多包都这样做。你想了解核，你可以操作它，玩它，看到它。我喜欢把它正对着放，然后你可以看到它想要成为一个圆形的，当你这样做时，横截面会被画出来。它想要成为一个圆形的横截面。如果我用更高阶的核，它会更圆。你可以看到现在它看起来相当圆。但我喜欢这样做。我喜欢这种，我可以整天这样做，这种抛物线状的横截面朝这边，圆形的横截面水平方向。但我可以整天玩这些东西，但我没有一整天的时间。所以让我们继续。

## 五、 相关的计算机科学概念

### 数据结构 (Data Structures - Offset Arrays)

这就是高斯核。你可能注意到了这个偏移数组 (`OffsetArray`)。我只是想快速向你展示一下如何定义它。这里的核，让我们看一下这里的核，核是——让我们把它变小一点，这样更容易看。好的，所以这里的核现在是 $5 \times 5$ 的核。你可以看到 $(0,0)$ 项，对吧，如果你是那些认为事物必须从 0 开始的 Python 用户，或者如果你是 Fortran 用户，认为事物必须从 1 开始。让我指出，我实际上是从中间开始的。$(0,0)$ 项，你可以看到是 0.162，就在中间这里。$(-2, -2)$ 项（译者注：视频演示中似乎指左上角，应为`(-2,-2)`或根据Grant的图是`(-2,2)`? 参照代码 `i` from -2 to 2, `j` from -2 to 2，`i`是行，`j`是列，`(-2,-2)`是左上角，值为0.003）是向左 2 格向上 2 格的那个，就是这个数字，你可以看到。

对吧，所以我会向你展示如何让任何矩阵从你想要的任何位置开始。Python 的 0 或 Fortran 的 1 并没有什么神奇之处，我是说这不重要，对吧。这里你只需要保持一致，麻烦就在这里。

但这是一个 $3 \times 5$ 的数组，从 1 到 15。好的，我称它为 `M`。我要做的是把我普通的香草味数组 `M`，就在这里，变成一个偏移数组 `Z`，通过指定我的行索引从 -1 到 1，我的列索引从 -2 到 2。这是三个数字，那是五个数字。你甚至可以看到索引，我只是为你列出来了。所以如果我去访问 `Z` 的 `(1, -2)`，你看它会做什么，它会取出 11，对吧，因为这是行 -1, 0, 1，这是列 -2。所以它取出了 11。诀窍不是对语言生气，诀窍是使用对当前问题来说自然的数据结构，对吧。这就是人们做事的方式。

## 六、 拓展思考与实践问题

### 离散 vs. 连续 (Discrete vs. Continuous)

好的，如果我要遵守我的微世纪时间限制，我想我只剩下时间讲最后一点了，但我认为这就是我真正需要的全部。所以我想谈一点关于离散与连续的问题，因为这可能会在你的本科生涯和工作生涯中反复出现。

我经常听到人们说这样的话，哦，我喜欢这个离散的东西，但我真的讨厌连续的对象。或者反过来，你知道，我喜欢连续数学，离散的，我不太懂离散数学。还有些人说，我真的，我对两者都了解不够等等。

但我想告诉你的是，离散和连续之间的差异远没有许多人让你相信的那么大。例如，当我向你展示这些卷积并且它们是离散化的时候，我是说你们都可以很容易地想象一个钟形曲线的极限。或者当我谈到那个梯度 x 滤波器时，让我们把它调出来，这样你可以看到它。我是说这无非就是一个导数，对吧。我是说它是导数的一个离散版本。它在哪里？它在哪里？它在哪里？我想在更上面。但我找不到了。抱歉，它在更下面。但是像这一个，这只是 x 方向上的一个导数，对吧。它是离散化的，当然。但它只是一个导数。

根据我的经验，离散和连续之间的区别更多地在于历史上演变出了不同的名称，而不是实际的底层智力概念，总的来说是这样。所以你知道，人们可以和我争论，你可以不同意我的观点，如果你愿意的话。但我真正邀请你做的是，当你继续学习其他课程，甚至这门课程时，你知道，我希望你保持开放的眼光，看看连续和离散是否真的像某些人让你相信的那样截然不同。

### 尊重边界 (Respect my Boundaries)

好的，我想我的“微世纪”时间到了。我可能本该说的最后一件事，但你可以自己去看，因为 Grant 在这方面做得非常好，那就是当你做这些卷积时，你可能已经可以想象到一些事情，你会遇到边界上的问题。这里让我看看是否能找到一个——有没有什么——是的，让我找张图片。看看是否能，好吧，我没能快速找到它。

但是当你到达边界时，不清楚你应该做什么，对吧。事实上，你，作为程序员，必须做出决定。当你掉下地球边缘时，你是否假装它们是零？你是否回去从内部重复使用一些像素？对吧，人们想出了很多很多选择。没有唯一的正确答案。对于手头的特定问题，可能有更好的答案。但是你必须处理边界这一事实有点——它变成了一个有点麻烦的软件问题，因为它很讨厌。所以你知道，好的软件可能会找到方法让你更容易处理，而坏的软件意味着你必须自己完成所有困难的工作。但你仍然必须尊重边界。

## 七、 总结

好了，现在我非常确定正式结束了。所以如果麻省理工学院的学生想留下来，他们是受欢迎的，但我将停止向公众广播。我要感谢公众的收听。

那么让我看看我怎么停止——我怎么停止这个？我现在都做完了。只是看看我能不能弄清楚怎么停止这个。我以前知道怎么做的。


---

# 要点回顾

**MIT 计算思维 2021春季 | 讲座 2：变换图像 - 框架与要点**

**一、 引言与设置**
- 课程简介：MIT 计算思维入门第二讲，主题为变换图像。
- 授课时长：讲座时间调整为接近1小时（约53分钟），引用 John von Neumann 的“微世纪”（microcentury）概念。
- Julia Unitful.jl 包演示：
    - 展示 Julia 如何通过 Unitful.jl 包处理带单位的数字。
    - 单位运算（如时间、长度、能量）可以直接进行，例如计算“微世纪”等于多少分钟 ($10^{-6}$ 世纪 $\approx 53$ 分钟)。
    - 示例：计算势能 $m \times g \times h$，单位会自动处理。
    - 深层含义：体现了 Julia 类型系统的强大之处，无需重写代码即可扩展功能（如支持单位运算），追求代码的通用性和组合性。

**二、 基本图像变换**
- **像素化 (降采样/升采样)**
    - 降采样：通过选取每隔 $r$ 个像素来降低图像分辨率。$r$ 越大，像素化越明显。
    - 升采样：使用克罗内克积 (Kronecker product) 将降采样后的每个像素替换为一个 $r \times r$ 的像素块，块内所有像素颜色相同。
- **线性组合 (图像合并)**
    - 概念：结合了两种基本操作：缩放对象（乘以标量）和组合多个对象（相加）。广泛应用于数学、科学和工程领域。
    - 图像缩放：将图像乘以常数 $c$ (c .* image) 可以改变亮度。这是逐元素（element-wise）或广播（broadcast）操作。
    - 图像叠加：将两个（或多个）图像按比例相加，例如 $0.5 * \text{图像1} + 0.5 * \text{图像2}$。
    - **凸组合 (Convex Combinations):**
        - 一种特殊的线性组合，系数非负且总和为1，形式如 $\alpha * \text{图像1} + (1-\alpha) * \text{图像2}$，其中 $0 \le \alpha \le 1$。
        - 用于平滑地混合或过渡两张图像。
        - 观察现象：混合正向和倒置的 Corgi 图像时，即使权重为50/50，人脑似乎也倾向于优先识别正向图像。
        - 关联概念：提及“面孔倒置效应”（Face Inversion Effect）或“撒切尔效应”（Thatcher Illusion），即人脑处理倒置面孔的效率低于正向面孔。

**三、 核心概念：图像滤波与卷积**
- 动机：许多常见的图像处理效果（如模糊、锐化、边缘检测）可以通过卷积实现。
- 卷积 (Convolution) 定义：
    - 将一个小矩阵（称为“核”或 Kernel）滑过整个图像。
    - 对于图像中的每个像素，计算其邻域像素值的加权平均，权重由核定义。
    - 引用 Grant Sanderson 的视频片段进行可视化解释。
- 核 (Kernel)：定义卷积操作权重的小矩阵。

**四、 常见滤波器/核及其应用**
- **在 Julia 中实现和演示不同核：**
    - 恒等核 (Identity)：中心为1，其余为0，卷积结果为原图。
    - 边缘检测核 (Edge Detect)：突出像素与其邻居的差异，例如中心权重为4，周围邻居权重为-1。$4 \times \text{中心} - \sum \text{邻居}$。
    - 锐化核 (Sharpen)：通常是恒等核与边缘检测核的组合 ($Identity + EdgeDetect$)，旨在增强边缘同时保留原图信息。（讨论了其他可能的定义，如 $2 \times Identity - BoxBlur$）。
    - 方框模糊核 (Box Blur)：核的所有元素相等（例如，对于 $3 \times 3$ 核，每个元素为 $1/9$），计算邻域像素的简单平均值。
    - 梯度核 (X/Y Gradient)：
        - 近似图像在水平 (X) 或垂直 (Y) 方向上的导数。
        - X梯度示例：$\frac{1}{2} \times \text{右邻居} - \frac{1}{2} \times \text{左邻居}$，检测垂直边缘。
        - Y梯度示例：类似地检测水平边缘。
        - 常用于组合以获得旋转不变的边缘信息。
- **高斯滤波器/模糊 (Gaussian Filter/Blur):**
    - 使用高斯核，其权重根据高斯函数（钟形曲线）$e^{-(x^2+y^2)/(2\sigma^2)}$ 计算。
    - 距离中心越近的像素权重越高，距离越远权重越低。
    - 相比方框模糊，产生更平滑自然的模糊效果。
    - 具有良好的数学特性。

**五、 相关的计算机科学概念**
- **复杂度 (Complexity):**
    - 卷积运算的计算量大致与（图像像素数）$\times$（核的大小）成正比。
    - 小核通常计算更快。
- **计算架构 (Architectures - GPUs):**
    - 卷积具有高度规则的计算模式。
    - 图形处理器 (GPU) 最初为游戏图形渲染设计，但非常擅长并行处理这种规则运算。
    - GPU 大幅加速卷积计算，对机器学习（尤其是图像识别）至关重要。
- **数据结构 (Data Structures - Offset Arrays):**
    - Julia 允许创建索引不从1（或0）开始的数组，称为偏移数组 (OffsetArray)。
    - 这对于定义中心位于 $(0,0)$ 的卷积核非常方便，使代码更自然。

**六、 拓展思考与实践问题**
- **离散 vs. 连续 (Discrete vs. Continuous):**
    - 许多离散操作（如梯度滤波器）是连续概念（如导数）的近似。
    - 讲者认为两者之间的差异可能不如通常认为的那么大，鼓励学生在学习中注意它们之间的联系。
- **边界处理 (Boundary Handling):**
    - 当卷积核移动到图像边缘时，需要处理超出边界的像素访问。
    - 常见策略：用0填充（padding）、镜像边界像素、重复边界像素等。
    - 这是卷积实现中一个实际且重要的软件工程问题，需要根据具体应用选择合适的策略。

**七、 总结**
- 讲座在“微世纪”的时间内介绍了图像变换的核心概念，特别是卷积及其在 Julia 中的实现与应用，并关联了相关的数学和计算机科学思想。